{% schema %}
{
  "name": "Alp Article Custom",
  "class": "alp-article-custom",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Section Title"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#000000"
    },
    {
      "type": "select",
      "id": "container",
      "label": "Layout",
      "default": "alp-container",
      "options": [
        {
          "value": "alp-container",
          "label": "Default"
        },
        {
          "value": "alp-container-fluid",
          "label": "Fluid container"
        },
        {
          "value": "alp-full-width",
          "label": "Full width"
        }
      ]
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding top",
      "default": 0,
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "em"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding bottom",
      "default": 0,
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "em"
    },
    {
      "type": "checkbox",
      "id": "reset_spacing",
      "label": "Remove default space between sections",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "video_item",
      "name": "Video Item",
      "settings": [
        {
          "id": "video_url",
          "type": "video_url",
          "label": "Video url",
          "accept": ["youtube", "vimeo"],
          "default": "https://www.youtube.com/watch?v=_9VUPq3SxOc",
          "info": "youtube or vimeo url"
        },
        {
          "type": "text",
          "id": "block_id",
          "label": "Block ID",
          "default": "video-item-a",
          "info": "使用方法: 在文章中添加一个h5, 文字填写block_id, 即可显示该视频",
          "placeholder": "video-item-a"
        }
      ]
    },
    {
      "type": "images_item",
      "name": "Images Item",
      "settings": [
        {
          "type": "image_picker",
          "id": "image_1",
          "label": "Image 1"
        },
        {
          "type": "text",
          "id": "image_text_1",
          "label": "Image Text 1"
        },
        {
          "type": "image_picker",
          "id": "image_2",
          "label": "Image 2"
        },
        {
          "type": "text",
          "id": "image_text_2",
          "label": "Image Text 2"
        },
        {
          "type": "image_picker",
          "id": "image_3",
          "label": "Image 3"
        },
        {
          "type": "text",
          "id": "image_text_3",
          "label": "Image Text 3"
        },
        {
          "type": "text",
          "id": "block_id",
          "label": "Block ID",
          "default": "images-item-a",
          "info": "使用方法: 在文章中添加一个h5, 文字填写block_id, 即可显示该视频",
          "placeholder": "images-item-a"
        }
      ]
    },
    {
      "type": "product_item_a",
      "name": "Product Item A",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        },
        {
          "type": "image_picker",
          "id": "review_image",
          "label": "Review Image"
        },
        {
          "type": "text",
          "id": "product_sub_title",
          "label": "Product Sub Title",
          "default": "OFF-ROAD EBIKE"
        },
        {
          "type": "textarea",
          "id": "product_badges",
          "label": "Product Badges",
          "default": "Best Seller, New Product"
        },
        {
          "type": "image_picker",
          "id": "product_image",
          "label": "Product Image"
        },
        {
          "id": "video_url",
          "type": "video_url",
          "label": "Video url",
          "accept": ["youtube", "vimeo"],
          "default": "https://www.youtube.com/watch?v=_9VUPq3SxOc",
          "info": "youtube or vimeo url"
        },
        {
          "type": "text",
          "id": "block_id",
          "label": "Block ID",
          "default": "product-item-a",
          "info": "使用方法: 在文章中添加一个h5, 文字填写block_id, 即可显示该产品",
          "placeholder": "product-item-a"
        },
        {
          "type": "select",
          "id": "product_type",
          "label": "Product Type",
          "default": "type-1",
          "options": [
            {
              "value": "type-1",
              "label": "Type 1"
            },
            {
              "value": "type-2",
              "label": "Type 2"
            }
          ]
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Alp Article Custom"
    }
  ]
}
{% endschema %}

{% liquid
  assign st = section.settings
  assign container = st.container
  assign reset_spacing = ''
  if st.reset_spacing
    assign reset_spacing = ' remove_spacing'
  endif
%}

{%- capture style -%}
    --bg-color: {{ st.bg_color }};--text-color: {{ st.text_color }};--padding-top: {{ st.padding_top }};--padding-bottom: {{ st.padding_bottom }};
{%- endcapture -%}

{% style %}
  .alp-article-custom-list {
    max-width: 980px;
  }
  .alp-article-custom-product-item-wrapper,
  .alp-article-custom-video-item-wrapper,
  .alp-article-custom-images-item-wrapper {
    margin: 2em 0;
  }
  .alp-main-article-left .article-template__content .installment-container-img img {
    margin: 0;
    max-width: 54px;
  }
{% endstyle %}

<div class="alp-section alp-article-custom-section hidden {{ reset_spacing }}" style="{{ style }}">
  <div class="alp-section-container alp-article-custom-container page-width {{ container }}">
    <div class="alp-article-custom-list">
      {%- if section.blocks.size > 0 -%}
        {%- for block in section.blocks -%}
          {% liquid
            assign bs = block.settings
          %}
          {% case block.type %}
            {% when 'product_item_a' %}
              <div class="alp-article-custom-product-item-wrapper" data-id="{{- bs.block_id -}}">
                {% render 'alp-article-custom-product-item-a', block: block, product: bs.product, aspect_ratio: '5/4' %}
              </div>
            {% when 'video_item' %}
              <div class="alp-article-custom-video-item-wrapper" data-id="{{- bs.block_id -}}">
                {% render 'alp-custom-video-item', block: block, aspect_ratio: '16/9' %}
              </div>
            {% when 'images_item' %}
              <div class="alp-article-custom-images-item-wrapper" data-id="{{- bs.block_id -}}">
                {% render 'alp-custom-images-item', block: block, aspect_ratio: '4/3' %}
              </div>
          {% endcase %}
        {%- endfor -%}
      {% endif %}
    </div>
  </div>
</div>

<script>
  if (Shopify.designMode) {
    document.querySelector('.alp-article-custom-section').classList.remove('hidden');
  }
  document.addEventListener('DOMContentLoaded', () => {
    if (!Shopify.designMode) {
      $('.article-template__content h5').each(function () {
        let $this = $(this);
        const blockId = $this[0].innerText;
        // remove innerText's \n
        // blockId = blockId.replace(/\n/g, '');
        const block = $(`.alp-article-custom-list > [data-id="${blockId}"]`);
        if (block.length > 0) {
          $this.after(block);
          $this.remove();
        }
      });
      lazyLoadInstance.update();
    }
  });
</script>
